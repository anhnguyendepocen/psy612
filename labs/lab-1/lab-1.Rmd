---
title: "Lab 1: Correlations"
output: 
  html_document: 
    fig_caption: yes
    theme: cosmo
    toc: yes
    toc_depth: 3
    toc_float: TRUE
---

# Purpose

Today's lab will focus on correlations. We will discuss how to calculate a correlation coefficient between two variables, how to assess statistical significance of correlations, and a variety of tools for visualizing correlations, especially among large groups of variables. 

To quickly navigate to the desired section, click one of the following links:

1. [Calculating covariances and correlations](#corcoeff)
1. [Hypothesis testing with correlations](#stats)
1. [Visualizing correlations](#plot)

You will need to load the following libraries to follow along with today's lab:

```{r message=FALSE}
library(tidyverse)
library(rio)
library(psych)
```

***

# Calculating covariances and correlations{#corcoeff}

## Covariance

* Before we talk about correlations, let's review the concept of **covariance**. Simply put, covariance captures how the variances of two variables are related, i.e. how they *co*-vary.

$$\large cov_{xy} = {\frac{\sum{(x-\bar{x})(y-\bar{y})}}{N-1}}$$

* You'll notice that this formula looks very similar to the formula for calculating the **variance** of a single variable:

$$\large s^{2} = {\frac{\sum{(x-\bar{x})^2}}{N-1}}$$

* To calculate covariance, use `cov()`. This function comes from the `{stats}` package, which is already loaded when you open R. 

Let's use the `mtcars` dataset as a quick example:

```{r}
cars <- mtcars %>% 
  select_if(is.numeric)
```

* Calculate the covariance between `cars$mpg` and `cars$hp`:

```{r}
cov(cars$mpg, cars$hp)
```


* Feeding `cov()` a data frame (of numeric variables), will generate a covariance matrix. Let's start with a data frame that only includes `mpg` and `hp`. We'll also round to two decimal places for convenience. 

```{r}
round(cov(cars %>% select(mpg, hp)), 2)

# alternatively...
#cov(cars[, c("mpg", "hp")])
```


**Question:** What do the numbers `36.32` and `4700.87` along the diagonal represent? 

* We can also easily generate a covariance matrix of more than 2 variables:

####  {.tabset .tabset-fade .tabset-pills}

##### Code

```{r eval=FALSE}
round(cov(cars), 2)
```

##### Output

```{r echo=FALSE}
round(cov(cars), 2)
```

####

## Correlation      

* Correlations are *standardized* covariances. Because correlations are in standardized units, we can compare them across scales of measurements and across studies. Recall that mathematically, a correlation is the product of two z-scored variables.

$$\large r_{xy} = {\frac{\sum({z_{x}z_{y})}}{N}}$$

* To calculate a correlation coefficient, use `cor()` (again, from the `{stats}` package).

```{r}
cor(cars$mpg, cars$hp)
```

* As with covariances, we can generate a matrix of correlations by feeding a data frame to `cor()`. The following code will give us a correlation matrix of `mpg` and `hp`. 

```{r}
round(cor(cars %>% select(mpg, hp)), 2)
```

* To get a correlation of all the variables in our data frame:

####  {.tabset .tabset-fade .tabset-pills}

##### Code

```{r eval=FALSE}
round(cor(cars), 2)
```

##### Output

```{r echo=FALSE}
round(cor(cars), 2)
```

####

*** 

# Hypothesis testing with correlations{#stats}

To illustrate how to assess statistical significance of correlations, we are going to work with a dataset about the relationship between conscientiousness and physical health. We've collected data from 60 people (30 men and 30 women) on their self-reported conscientiousness (using the BFI) and their self-reported physical health. We want to know if there is a significant correlation between these variables, and then whether or not that correlation differs between men and women.

* Import the data using the following code:

```{r}
health <- import("https://raw.githubusercontent.com/uopsych/psy612/master/labs/lab-1/data/consc_health.csv")
```


***

## Steps of hypothesis testing

## Power calculation 

## R functions

### `stats::cor.test()`

### `psych::corr.test()`

## Confidence intervals

## Comparing correlations by group

### `psych::r.test()`

***

# Visualizing correlations{#plot}

***

# Minihacks

## Minihack 1

***

## Minihack 2

***

## Minihack 3
