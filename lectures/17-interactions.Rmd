---
title: 'Interactions (IV)'
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: [default, rladies, rladies-fonts, "my-theme.css"]
    incremental: true
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

## Last time...

Factorial ANOVA

---

## Today

- Polynomials

- 3-way interactions

---

## Non-linear relationships

Linear lines often make bad predictions -- very few processes that we study actually have linear relationships. For example, effort had diminishing returns (e.g., log functions), or small advantages early in life can have significant effects on mid-life outcones (e.g., exponentional functions). In cases where the direction of the effect is constant but changing in magnitude, the best way to handle the data is to transform a variable (usually the outcome) and run linear analyses.

```{r, eval = F}
log_y = ln(y)
lm(log_y ~ x)
```
---

## Polynomial relationships

Other processes represent changes in the directon of relationship -- for example, it is believed that a small amount of anxiety is benefitial for performance on some tasks (positive direction) but too much is detrimental (negative direction). When the shape of the effect includes change(s) in direction, then a polynomial term(s) may be more appropriate.

It should be noted that polynomials are often a poor approximation for a non-linear effect of X on Y. However, correctly testing for non-linear effects usually requires (a) a lot of data and (b) making a number of assumptions about the data. Polynomial regression can be a useful tool for exploratory analysis and in cases when data are limited in terms of quantity and/or quality.


---
## Polynomial regression 
 
Polynomial regression is most often a form of hierarchical regressoin that systematically tests a series of higher order functions for a single variable.

$$
\begin{aligned}
\large \textbf{Linear: } \hat{Y} &= b_0 + b_1X \\
\large \textbf{Quadtratic: } \hat{Y} &= b_0 + b_1X + b_2X^2 \\
\large \textbf{Cubic: } \hat{Y} &= b_0 + b_1X + b_2X^2 + b_3X^3\\
\end{aligned}
$$

---
```{r, echo = FALSE, warning= FALSE, message = F}
library(ggplot2)
library(here)
mtcars2 <- read.csv(here("data/mtcars2.csv"))
quad <- lm(mpg ~ hp + I(hp^2), data = mtcars2)
prd <- data.frame(hp = seq(from = range(mtcars2$hp)[1], to = range(mtcars2$hp)[2], length.out = 100))
err <- predict(quad, newdata = prd, se.fit = TRUE)

prd$lci <- err$fit - 1.96 * err$se.fit
prd$fit <- err$fit
prd$uci <- err$fit + 1.96 * err$se.fit

ggplot(prd, aes(x = hp, y = fit)) +
  theme_bw() +
  geom_line() +
  geom_smooth(aes(ymin = lci, ymax = uci), stat = "identity") +
  geom_point(data = mtcars2, aes(x = hp, y = mpg)) +
  theme_bw(base_size = 20)
```


---

```{r}
library(broom)
tidy(quad)
```

---

## When should you use polynomial terms?
- theory
- scatter plots
- residual plot
- safeguard

---
## Interpretation

- intercept is predicted value when x = 0
- The b1 coefficient is the tangent to the curve when X=0.     
    + rate of change when x = 0  
    + thus important to center

```{r}
mtcars2$hp.c <- scale(mtcars2$hp, center = TRUE, scale = FALSE)
mtcars2$hp.c <- as.numeric(mtcars2$hp.c)
quad.c <- lm(mpg ~ hp.c + I(hp.c^2), data = mtcars2)
tidy(quad.c)
```

---
```{r, echo = FALSE, warning= FALSE}
prd.c <- data.frame(hp.c = seq(from = range(mtcars2$hp.c)[1], to = range(mtcars2$hp.c)[2], length.out = 100))

err.c <- predict(quad.c, prd.c, se.fit = TRUE)

prd.c$lci <- err.c$fit - 1.96 * err$se.fit
prd.c$fit <- err.c$fit
prd.c$uci <- err.c$fit + 1.96 * err$se.fit

ggplot(prd.c, aes(x = hp.c, y = fit)) +
  theme_bw() +
  geom_line() +
  geom_smooth(aes(ymin = lci, ymax = uci), stat = "identity") +
  geom_point(data = mtcars2, aes(x = hp.c, y = mpg))
```


---
## Interpretation

- The b2 coefficient is the acceleration 
- More specifically, 2*b2 is the acceleration â€“ the rate of change in b1 for a 1-unit change in X   

<br>
b1+2*b2X = slope of tangent line at a particular value of X

```{r}
 -0.0898514747 + 2*0.0004208156*106.75
```

```{r}
 -0.0898514747 + 2*0.0004208156*180
```

